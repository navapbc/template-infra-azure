#!/usr/bin/env bash
set -euo pipefail

app_name="$1"
image_tag="$2"
environment="$3"

echo "--------------"
echo "Deploy release"
echo "--------------"
echo "Input parameters:"
echo "  app_name=${app_name}"
echo "  image_tag=${image_tag}"
echo "  environment=${environment}"
echo
echo "Starting ${app_name} deploy of ${image_tag} to ${environment}"

TF_CLI_ARGS_apply="-input=false -auto-approve -var=image_tag=${image_tag}" make infra-update-app-service APP_NAME="${app_name}" ENVIRONMENT="${environment}"

echo "Completed ${app_name} deploy of ${image_tag} to ${environment}"
